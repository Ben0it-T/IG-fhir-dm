{
  "resourceType": "https://sql-on-fhir.org/ig/StructureDefinition/ViewDefinition",
  "url": "https://interop.aphp.fr/ig/fhir/dm/ViewDefinition/OMOP-Provider-View",
  "title": "OMOP Provider View",
  "description": "ViewDefinition to transform FHIR Practitioner resources into OMOP Provider table format",
  "name": "OMOP-Provider-View",
  "status": "draft",
  "resource": "Practitioner",
  "select": [
    {
      "column": [
        {
          "name": "provider_id",
          "path": "Practitioner.id",
          "description": "Unique identifier for the provider",
          "type": "integer"
        },
        {
          "name": "provider_name",
          "path": "Practitioner.name.first().family + ', ' + Practitioner.name.first().given.first()",
          "description": "Provider name from name elements",
          "type": "string"
        },
        {
          "name": "npi",
          "path": "Practitioner.identifier.where(system='http://hl7.org/fhir/sid/us-npi').value",
          "description": "NPI from identifier with NPI system",
          "type": "string"
        },
        {
          "name": "dea",
          "path": "Practitioner.identifier.where(system='http://terminology.hl7.org/NamingSystem/us-dea-number').value",
          "description": "DEA number from identifier",
          "type": "string"
        },
        {
          "name": "specialty_concept_id",
          "path": "Practitioner.qualification.first().code.coding.first().code",
          "description": "Specialty concept from qualification",
          "type": "integer"
        },
        {
          "name": "care_site_id",
          "path": "Practitioner.extension.where(url='http://hl7.org/fhir/StructureDefinition/practitioner-job').valueReference.reference.substring(13)",
          "description": "Care site from practitioner job extension",
          "type": "integer"
        },
        {
          "name": "year_of_birth",
          "path": "Practitioner.birthDate.toString().substring(0,4).toInteger()",
          "description": "Year of birth from birth date",
          "type": "integer"
        },
        {
          "name": "gender_concept_id",
          "path": "Practitioner.gender",
          "description": "Gender concept from gender",
          "type": "integer"
        },
        {
          "name": "provider_source_value",
          "path": "Practitioner.identifier.first().value",
          "description": "Source value for provider identification",
          "type": "string"
        },
        {
          "name": "specialty_source_value",
          "path": "Practitioner.qualification.first().code.text",
          "description": "Source value for specialty",
          "type": "string"
        },
        {
          "name": "specialty_source_concept_id",
          "path": "0",
          "description": "Source concept for specialty (default 0)",
          "type": "integer"
        },
        {
          "name": "gender_source_value",
          "path": "Practitioner.gender",
          "description": "Source value for gender",
          "type": "string"
        },
        {
          "name": "gender_source_concept_id",
          "path": "0",
          "description": "Source concept for gender (default 0)",
          "type": "integer"
        }
      ]
    }
  ]
}
