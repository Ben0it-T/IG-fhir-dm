{
  "resourceType": "https://sql-on-fhir.org/ig/StructureDefinition/ViewDefinition",
  "url": "https://aphp.fr/ig/fhir/dm/ViewDefinition/OMOP-Measurement-View",
  "title": "OMOP Measurement View",
  "description": "ViewDefinition to transform FHIR Observation resources into OMOP Measurement table format",
  "name": "OMOP-Measurement-View",
  "status": "draft",
  "resource": "Observation",
  "select": [
    {
      "column": [
        {
          "name": "measurement_id",
          "path": "getResourceKey()",
          "description": "Unique identifier for the measurement",
          "type": "integer"
        },
        {
          "name": "person_id",
          "path": "Observation.subject.reference.substring(8)",
          "description": "Reference to person from subject",
          "type": "integer"
        },
        {
          "name": "measurement_date",
          "path": "Observation.effectiveDateTime.toString().substring(0,10)",
          "description": "Measurement date from effective datetime",
          "type": "date"
        },
        {
          "name": "measurement_datetime",
          "path": "Observation.effectiveDateTime",
          "description": "Measurement datetime from effective datetime",
          "type": "dateTime"
        },
        {
          "name": "measurement_time",
          "path": "Observation.effectiveDateTime.toString().substring(11,19)",
          "description": "Measurement time from effective datetime",
          "type": "string"
        },
        {
          "name": "value_as_number",
          "path": "Observation.valueQuantity.value",
          "description": "Numeric value from value quantity",
          "type": "decimal"
        },
        {
          "name": "range_low",
          "path": "Observation.referenceRange.first().low.value",
          "description": "Range low from reference range",
          "type": "decimal"
        },
        {
          "name": "range_high",
          "path": "Observation.referenceRange.first().high.value",
          "description": "Range high from reference range",
          "type": "decimal"
        },
        {
          "name": "provider_id",
          "path": "Observation.performer.first().reference.substring(12)",
          "description": "Provider identifier from performer",
          "type": "integer"
        },
        {
          "name": "visit_occurrence_id",
          "path": "Observation.encounter.reference.substring(10)",
          "description": "Visit occurrence identifier from encounter",
          "type": "integer"
        },
        {
          "name": "visit_detail_id",
          "path": "Observation.encounter.reference.substring(10)",
          "description": "Visit detail identifier from encounter",
          "type": "integer"
        },
        {
          "name": "measurement_source_value",
          "path": "Observation.code.text",
          "description": "Source value for measurement",
          "type": "string"
        },
        {
          "name": "unit_source_value",
          "path": "Observation.valueQuantity.unit",
          "description": "Source value for unit",
          "type": "string"
        },
        {
          "name": "value_source_value",
          "path": "Observation.valueString",
          "description": "Source value for the observation value",
          "type": "string"
        }
      ]
    }
  ]
}
