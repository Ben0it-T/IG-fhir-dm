version: 2

sources:
  - name: ehr
    description: "Electronic Health Records source database containing patient clinical data"
    database: data_core
    schema: dbt_seeds
    
    tables:
      - name: patient_sample
        description: "Patient demographic and identification data"
        columns:
          - name: patient_id
            description: "Unique patient identifier"
            tests:
              - unique
              - not_null
          - name: nom
            description: "Patient family name"
          - name: prenom
            description: "Patient given name"
          - name: nir
            description: "French national insurance number"
          - name: ins
            description: "French national health insurance identifier"
          - name: date_naissance
            description: "Patient birth date"
            tests:
              - not_null
          - name: sexe
            description: "Patient gender (M/F)"
            tests:
              - accepted_values:
                  values: ['M', 'F']
          - name: latitude
            description: "Geographic latitude of residence"
          - name: longitude
            description: "Geographic longitude of residence"
          - name: code_geographique_residence
            description: "Postal code of residence"
          - name: libelle_geographique_residence
            description: "City name of residence"

      - name: donnees_pmsi_sample
        description: "Hospital stay data from PMSI system"
        columns:
          - name: pmsi_id
            description: "Unique PMSI episode identifier"
            tests:
              - unique
              - not_null
          - name: patient_id
            description: "Reference to patient"
            tests:
              - not_null
              - relationships:
                  to: source('ehr', 'patient_sample')
                  field: patient_id
          - name: mode_sortie
            description: "Discharge mode"
          - name: duree_sejour
            description: "Length of stay in days"
          - name: date_debut_sejour
            description: "Admission date"
            tests:
              - not_null
          - name: date_fin_sejour
            description: "Discharge date"
          - name: mode_entree
            description: "Admission mode"
          - name: etablissement
            description: "Healthcare facility name"
          - name: service
            description: "Medical service/department"

      - name: diagnostics_sample
        description: "Diagnostic codes from hospital stays"
        columns:
          - name: diagnostic_id
            description: "Unique diagnostic identifier"
            tests:
              - unique
              - not_null
          - name: pmsi_id
            description: "Reference to PMSI episode"
            tests:
              - not_null
              - relationships:
                  to: source('ehr', 'donnees_pmsi_sample')
                  field: pmsi_id
          - name: code_diagnostic
            description: "ICD-10 diagnostic code"
          - name: type_diagnostic
            description: "Type of diagnosis (Principal, Secondaire, etc.)"
          - name: libelle_diagnostic
            description: "Diagnostic label in French"
          - name: date_diagnostic
            description: "Date of diagnosis"

      - name: actes_sample
        description: "Medical procedures performed"
        columns:
          - name: acte_id
            description: "Unique procedure identifier"
            tests:
              - unique
              - not_null
          - name: pmsi_id
            description: "Reference to PMSI episode"
            tests:
              - not_null
          - name: code_ccam
            description: "CCAM procedure code"
          - name: libelle_acte
            description: "Procedure description in French"
          - name: date_acte
            description: "Date procedure was performed"

      - name: biologie_sample
        description: "Laboratory test results"
        columns:
          - name: biologie_id
            description: "Unique lab test identifier"
            tests:
              - unique
              - not_null
          - name: pmsi_id
            description: "Reference to PMSI episode"
          - name: patient_id
            description: "Reference to patient"
            tests:
              - not_null
          - name: code_loinc
            description: "LOINC code for the laboratory test"
          - name: libelle_test
            description: "Test name in French"
          - name: valeur
            description: "Test result value"
          - name: unite
            description: "Unit of measurement"
          - name: laboratoire
            description: "Laboratory name"
          - name: date_prelevement
            description: "Sample collection date"

      - name: exposition_medicamenteuse_sample
        description: "Medication exposure data"
        columns:
          - name: exposition_id
            description: "Unique medication exposure identifier"
            tests:
              - unique
              - not_null
          - name: pmsi_id
            description: "Reference to PMSI episode"
          - name: patient_id
            description: "Reference to patient"
            tests:
              - not_null
          - name: code_atc
            description: "ATC medication code"
          - name: denomination
            description: "Medication name"
          - name: voie_administration
            description: "Route of administration"
          - name: date_prescription
            description: "Prescription date"

      - name: dossier_soins_sample
        description: "Nursing care records with vital signs"
        columns:
          - name: soins_id
            description: "Unique care record identifier"
            tests:
              - unique
              - not_null
          - name: pmsi_id
            description: "Reference to PMSI episode"
          - name: patient_id
            description: "Reference to patient"
            tests:
              - not_null
          - name: type_mesure
            description: "Type of vital sign measurement"
          - name: valeur
            description: "Measured value"
          - name: unite
            description: "Unit of measurement"
          - name: date_mesure
            description: "Date of measurement"

      - name: style_vie_sample
        description: "Lifestyle factors and social determinants"
        columns:
          - name: style_vie_id
            description: "Unique lifestyle record identifier"
            tests:
              - unique
              - not_null
          - name: patient_id
            description: "Reference to patient"
            tests:
              - not_null
          - name: type_facteur
            description: "Type of lifestyle factor"
          - name: valeur
            description: "Factor value or status"
          - name: date_evaluation
            description: "Date of assessment"