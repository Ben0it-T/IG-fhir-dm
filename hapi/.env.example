# HAPI FHIR Docker Environment Configuration
# Copy this file to .env and adjust values for your environment

# ============================================
# PostgreSQL Database Configuration
# ============================================
# Database connection settings
POSTGRES_DB=hapi                    # Database name
POSTGRES_USER=hapi                  # Database user
POSTGRES_PASSWORD=changeme123!      # CHANGE THIS: Strong password required
POSTGRES_PORT=5432                  # PostgreSQL port (default: 5432)

# PostgreSQL Performance Tuning
# Adjust based on available system memory
POSTGRES_MAX_CONNECTIONS=200        # Maximum number of concurrent connections
POSTGRES_SHARED_BUFFERS=256MB       # Shared memory for caching (25% of RAM)
POSTGRES_EFFECTIVE_CACHE_SIZE=1GB   # Disk cache available to PostgreSQL (75% of RAM)
POSTGRES_MAINTENANCE_WORK_MEM=64MB  # Memory for maintenance operations
POSTGRES_CHECKPOINT_COMPLETION_TARGET=0.9
POSTGRES_WAL_BUFFERS=16MB
POSTGRES_DEFAULT_STATISTICS_TARGET=100
POSTGRES_RANDOM_PAGE_COST=1.1       # For SSD storage
POSTGRES_EFFECTIVE_IO_CONCURRENCY=200
POSTGRES_WORK_MEM=4MB
POSTGRES_MIN_WAL_SIZE=1GB
POSTGRES_MAX_WAL_SIZE=4GB

# PostgreSQL Resource Limits
POSTGRES_CPU_LIMIT=2                # CPU cores limit
POSTGRES_MEMORY_LIMIT=2G            # Memory limit
POSTGRES_CPU_RESERVATION=0.5        # Reserved CPU cores
POSTGRES_MEMORY_RESERVATION=512M    # Reserved memory

# ============================================
# HAPI FHIR Server Configuration
# ============================================
# HAPI Version
HAPI_VERSION=v7.0.0                 # HAPI FHIR Docker image version

# FHIR Configuration
HAPI_FHIR_VERSION=R4                # FHIR version (R4, R5, DSTU3)
HAPI_PORT=8080                      # HAPI FHIR server port
HAPI_DEBUG_PORT=5005                # Java debug port

# Server Settings
HAPI_SERVER_ADDRESS=http://localhost:8080/fhir
HAPI_SERVER_ID=hapi-fhir-server
HAPI_SERVER_NAME=HAPI FHIR Server
HAPI_IMPLEMENTATION_DESCRIPTION=Production HAPI FHIR Server

# Pagination Settings
HAPI_DEFAULT_PAGE_SIZE=20           # Default page size for search results
HAPI_MAX_PAGE_SIZE=200              # Maximum allowed page size

# Database Behavior
HAPI_ALLOW_EXTERNAL_REFERENCES=true
HAPI_ALLOW_MULTIPLE_DELETE=true
HAPI_ALLOW_OVERRIDE_DEFAULT_SEARCH_PARAMS=true
HAPI_ALLOW_CASCADING_DELETES=true
HAPI_ALLOW_CONTAINS_SEARCHES=true
HAPI_ALLOW_INLINE_MATCH_URL_REFERENCES=true
HAPI_ALLOW_PLACEHOLDER_REFERENCES=true
HAPI_AUTO_CREATE_PLACEHOLDER_REFERENCES=false

# Referential Integrity
HAPI_ENFORCE_REFERENTIAL_INTEGRITY=false

# Search Configuration
HAPI_ENABLE_INDEX_MISSING_FIELDS=false
HAPI_ENABLE_INDEX_CONTAINED_RESOURCE=false
HAPI_ADVANCED_LUCENE_INDEXING=false
HAPI_FILTER_SEARCH_ENABLED=true
HAPI_GRAPHQL_ENABLED=true

# Validation Settings
HAPI_VALIDATION_ENABLED=true
HAPI_VALIDATION_REQUESTS_ENABLED=true
HAPI_VALIDATION_RESPONSES_ENABLED=false

# Subscription Settings
HAPI_SUBSCRIPTION_RESTHOOK_ENABLED=false
HAPI_SUBSCRIPTION_EMAIL_ENABLED=false
HAPI_SUBSCRIPTION_EMAIL_FROM=noreply@example.com
HAPI_SUBSCRIPTION_EMAIL_HOST=localhost
HAPI_SUBSCRIPTION_EMAIL_PORT=25
HAPI_SUBSCRIPTION_WEBSOCKET_ENABLED=true

# Bulk Export
HAPI_BULK_EXPORT_ENABLED=true
HAPI_BULK_EXPORT_PATH=/data/bulk_export

# CORS Configuration
HAPI_CORS_ENABLED=true
HAPI_CORS_ALLOWED_ORIGIN=*         # CHANGE THIS: Specify allowed origins for production
HAPI_CORS_ALLOW_CREDENTIALS=false

# Tester UI
HAPI_TESTER_ENABLED=true
HAPI_TESTER_NAME=Local Tester
HAPI_TESTER_SERVER_ADDRESS=http://localhost:8080/fhir

# Binary Storage
HAPI_BINARY_STORAGE_ENABLED=true
HAPI_BINARY_STORAGE_PATH=/data/binary

# Cache Settings
HAPI_REUSE_CACHED_SEARCH_RESULTS=60000  # Milliseconds
HAPI_RETAIN_CACHED_SEARCHES=60          # Minutes

# Partitioning (Advanced Feature)
HAPI_PARTITIONING_ENABLED=false
HAPI_PARTITIONING_ALLOW_CROSS_REFS=false
HAPI_PARTITIONING_INCLUDE_IN_SEARCH=false

# MDM (Master Data Management)
HAPI_MDM_ENABLED=false

# Security
HAPI_SECURITY_ENABLED=false
HAPI_OAUTH_ENABLED=false
HAPI_BASIC_AUTH_ENABLED=false

# ============================================
# JVM Configuration
# ============================================
JVM_HEAP_MIN=1024m                  # Minimum heap size
JVM_HEAP_MAX=2048m                  # Maximum heap size (adjust based on available RAM)

# HAPI Resource Limits
HAPI_CPU_LIMIT=4                    # CPU cores limit
HAPI_MEMORY_LIMIT=4G                # Memory limit
HAPI_CPU_RESERVATION=1              # Reserved CPU cores
HAPI_MEMORY_RESERVATION=1G          # Reserved memory

# ============================================
# Hibernate Configuration
# ============================================
HIBERNATE_HBM2DDL_AUTO=update       # Schema generation (update, create, validate, none)
HIBERNATE_SHOW_SQL=false            # Show SQL queries in logs
HIBERNATE_FORMAT_SQL=false          # Format SQL queries in logs
HIBERNATE_BATCH_SIZE=20             # Batch size for bulk operations
HIBERNATE_USE_QUERY_CACHE=false     # Enable query cache
HIBERNATE_USE_SECOND_LEVEL_CACHE=false
HIBERNATE_USE_STRUCTURED_ENTRIES=false
HIBERNATE_USE_MINIMAL_PUTS=false
HIBERNATE_GENERATE_STATISTICS=false

# ============================================
# Connection Pool (HikariCP) Configuration
# ============================================
HIKARI_MAXIMUM_POOL_SIZE=20         # Maximum pool size
HIKARI_MINIMUM_IDLE=10              # Minimum idle connections
HIKARI_CONNECTION_TIMEOUT=30000     # Connection timeout (ms)
HIKARI_IDLE_TIMEOUT=600000          # Idle connection timeout (ms)
HIKARI_MAX_LIFETIME=1800000         # Maximum connection lifetime (ms)
HIKARI_LEAK_DETECTION_THRESHOLD=60000  # Leak detection threshold (ms)
HIKARI_VALIDATION_TIMEOUT=5000      # Validation timeout (ms)

# ============================================
# Nginx Configuration
# ============================================
NGINX_HTTP_PORT=80                  # HTTP port
NGINX_HTTPS_PORT=443                # HTTPS port
NGINX_CPU_LIMIT=0.5                 # CPU cores limit
NGINX_MEMORY_LIMIT=256M             # Memory limit

# ============================================
# Monitoring Configuration
# ============================================
# Prometheus
PROMETHEUS_PORT=9090                # Prometheus web UI port
PROMETHEUS_RETENTION=15d            # Data retention period
PROMETHEUS_CPU_LIMIT=0.5            # CPU cores limit
PROMETHEUS_MEMORY_LIMIT=512M        # Memory limit

# Grafana
GRAFANA_PORT=3000                   # Grafana web UI port
GRAFANA_USER=admin                  # CHANGE THIS: Grafana admin username
GRAFANA_PASSWORD=admin              # CHANGE THIS: Grafana admin password
GRAFANA_ROOT_URL=http://localhost:3000
GRAFANA_PLUGINS=                    # Comma-separated list of plugins to install
GRAFANA_CPU_LIMIT=0.5              # CPU cores limit
GRAFANA_MEMORY_LIMIT=256M          # Memory limit

# PostgreSQL Exporter
POSTGRES_EXPORTER_PORT=9187        # Metrics exporter port
POSTGRES_EXPORTER_CPU_LIMIT=0.25   # CPU cores limit
POSTGRES_EXPORTER_MEMORY_LIMIT=128M # Memory limit

# ============================================
# Tomcat Configuration
# ============================================
TOMCAT_MAX_THREADS=200              # Maximum threads
TOMCAT_MIN_SPARE_THREADS=10        # Minimum spare threads
TOMCAT_ACCEPT_COUNT=100            # Accept count
TOMCAT_MAX_CONNECTIONS=10000       # Maximum connections
TOMCAT_CONNECTION_TIMEOUT=60000    # Connection timeout (ms)

# ============================================
# Logging Configuration
# ============================================
LOG_LEVEL_ROOT=INFO                # Root log level
LOG_LEVEL_FHIR=INFO                # FHIR framework log level
LOG_LEVEL_HIBERNATE=WARN           # Hibernate log level
LOG_LEVEL_SQL=WARN                 # SQL log level
LOG_LEVEL_SQL_BINDING=WARN         # SQL parameter binding log level
LOG_LEVEL_SPRING=INFO              # Spring framework log level
LOG_LEVEL_WEB=INFO                 # Web layer log level

# ============================================
# Environment Settings
# ============================================
ENVIRONMENT=production             # Environment name (development, staging, production)
TZ=UTC                            # Timezone