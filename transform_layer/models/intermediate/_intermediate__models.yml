version: 2

models:
  # Core intermediate models
  - name: int_ehr__patient_fhir
    description: >
      Intermediate model transforming EHR patient data to FHIR Patient structure.
      Implements the TransformPatient group from the FML mapping.
    columns:
      - name: patient_id
        description: "FHIR Patient resource ID"
        tests:
          - not_null
          - unique
      - name: identifiers
        description: "FHIR Identifier array including INS-NIR and hospital IDs"
      - name: names
        description: "FHIR HumanName array"
      - name: gender
        description: "FHIR gender value (male/female/unknown)"
      - name: birth_date
        description: "FHIR birth date"
      - name: deceased_date_time
        description: "FHIR death date/time if applicable"
      - name: multiple_birth_integer
        description: "Multiple birth rank"
      - name: addresses
        description: "FHIR Address array"
      - name: meta
        description: "FHIR Meta object with DMPatient profile"

  - name: int_ehr__encounter_fhir
    description: >
      Intermediate model transforming EHR PMSI data to FHIR Encounter structure.
      Implements the TransformEncounter group from the FML mapping.
    columns:
      - name: encounter_id
        description: "FHIR Encounter resource ID"
        tests:
          - not_null
          - unique
      - name: patient_reference
        description: "Reference to FHIR Patient resource"
      - name: identifiers
        description: "FHIR Identifier array with PMSI ID"
      - name: status
        description: "FHIR Encounter status"
      - name: class
        description: "FHIR Encounter class coding"
      - name: period
        description: "FHIR Period for encounter duration"
      - name: length
        description: "FHIR Quantity for length of stay"
      - name: hospitalization
        description: "FHIR Encounter.hospitalization object"
      - name: service_provider
        description: "Reference to healthcare facility"
      - name: locations
        description: "FHIR Encounter.location array"

  - name: int_ehr__condition_fhir
    description: >
      Intermediate model transforming EHR diagnostics to FHIR Condition structure.
      Implements the TransformCondition group from the FML mapping.
    columns:
      - name: condition_id
        description: "FHIR Condition resource ID"
        tests:
          - not_null
          - unique
      - name: patient_reference
        description: "Reference to FHIR Patient resource"
      - name: encounter_reference
        description: "Reference to FHIR Encounter resource"
      - name: identifiers
        description: "FHIR Identifier array with diagnostic ID"
      - name: clinical_status
        description: "FHIR CodeableConcept for clinical status"
      - name: verification_status
        description: "FHIR CodeableConcept for verification status"
      - name: categories
        description: "FHIR CodeableConcept array for condition categories"
      - name: code
        description: "FHIR CodeableConcept with ICD-10 code"
      - name: recorded_date
        description: "FHIR date when condition was recorded"

  - name: int_ehr__procedure_fhir
    description: >
      Intermediate model transforming EHR acts to FHIR Procedure structure.
      Implements the TransformProcedure group from the FML mapping.
    columns:
      - name: procedure_id
        description: "FHIR Procedure resource ID"
        tests:
          - not_null
          - unique
      - name: patient_reference
        description: "Reference to FHIR Patient resource"
      - name: encounter_reference
        description: "Reference to FHIR Encounter resource"
      - name: identifiers
        description: "FHIR Identifier array with procedure ID"
      - name: status
        description: "FHIR Procedure status"
      - name: code
        description: "FHIR CodeableConcept with CCAM code"
      - name: performed_date_time
        description: "FHIR dateTime when procedure was performed"
      - name: performers
        description: "FHIR Procedure.performer array"

  # Clinical intermediate models
  - name: int_ehr__laboratory_observation_fhir
    description: >
      Intermediate model transforming EHR laboratory results to FHIR Observation structure.
      Implements the TransformLabObservation group from the FML mapping.
    columns:
      - name: observation_id
        description: "FHIR Observation resource ID"
        tests:
          - not_null
          - unique
      - name: patient_reference
        description: "Reference to FHIR Patient resource"
      - name: encounter_reference
        description: "Reference to FHIR Encounter resource"
      - name: identifiers
        description: "FHIR Identifier array with laboratory ID"
      - name: status
        description: "FHIR Observation status"
      - name: categories
        description: "FHIR CodeableConcept array with 'laboratory' category"
      - name: code
        description: "FHIR CodeableConcept with LOINC code"
      - name: effective_date_time
        description: "FHIR dateTime for sample collection"
      - name: value_quantity
        description: "FHIR Quantity for numeric results"
      - name: value_string
        description: "FHIR string for text results"
      - name: reference_ranges
        description: "FHIR Observation.referenceRange array"
      - name: performers
        description: "FHIR Reference array to performing laboratory"
      - name: notes
        description: "FHIR Annotation array for comments"

  - name: int_ehr__vital_signs_fhir
    description: >
      Intermediate model transforming EHR vital signs to multiple FHIR Observation structures.
      Implements the TransformVitalSigns group from the FML mapping.
    columns:
      - name: observation_id
        description: "FHIR Observation resource ID"
        tests:
          - not_null
          - unique
      - name: patient_reference
        description: "Reference to FHIR Patient resource"
      - name: encounter_reference
        description: "Reference to FHIR Encounter resource"
      - name: vital_sign_type
        description: "Type of vital sign (weight, height, bp_systolic, bp_diastolic)"
      - name: status
        description: "FHIR Observation status"
      - name: categories
        description: "FHIR CodeableConcept array with 'vital-signs' category"
      - name: code
        description: "FHIR CodeableConcept with LOINC vital signs code"
      - name: effective_date_time
        description: "FHIR dateTime for measurement"
      - name: value_quantity
        description: "FHIR Quantity for measurement value"
      - name: components
        description: "FHIR Observation.component array for blood pressure"

  - name: int_ehr__lifestyle_observation_fhir
    description: >
      Intermediate model transforming EHR lifestyle data to FHIR Observation structures.
      Implements the TransformLifestyle group from the FML mapping.
    columns:
      - name: observation_id
        description: "FHIR Observation resource ID"
        tests:
          - not_null
          - unique
      - name: patient_reference
        description: "Reference to FHIR Patient resource"
      - name: encounter_reference
        description: "Reference to FHIR Encounter resource"
      - name: lifestyle_type
        description: "Type of lifestyle observation (tobacco, alcohol, substance, activity)"
      - name: status
        description: "FHIR Observation status"
      - name: categories
        description: "FHIR CodeableConcept array with 'social-history' category"
      - name: code
        description: "FHIR CodeableConcept with LOINC social history code"
      - name: effective_date_time
        description: "FHIR dateTime for data collection"
      - name: value_codeable_concept
        description: "FHIR CodeableConcept for lifestyle status"

  # Medication intermediate models
  - name: int_ehr__medication_request_fhir
    description: >
      Intermediate model transforming EHR medication exposures to FHIR MedicationRequest structure.
      Implements the TransformMedicationRequest group from the FML mapping.
    columns:
      - name: medication_request_id
        description: "FHIR MedicationRequest resource ID"
        tests:
          - not_null
          - unique
      - name: patient_reference
        description: "Reference to FHIR Patient resource"
      - name: encounter_reference
        description: "Reference to FHIR Encounter resource"
      - name: identifiers
        description: "FHIR Identifier array with medication exposure ID"
      - name: status
        description: "FHIR MedicationRequest status"
      - name: intent
        description: "FHIR MedicationRequest intent"
      - name: medication_codeable_concept
        description: "FHIR CodeableConcept with ATC code"
      - name: authored_on
        description: "FHIR dateTime when prescription was authored"
      - name: requester
        description: "Reference to prescribing practitioner"
      - name: dosage_instructions
        description: "FHIR Dosage array for dosing instructions"